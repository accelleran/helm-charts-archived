{{ range $path, $_ :=  .Files.Glob  "configuration/grafana/dashboards/*.json" }}
{{ $filepath := base $path }}
{{ $filename:= splitList "." $filepath | first }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-{{ $filename }}
  namespace: {{ template "grafana.namespace" $ }}
  labels:
    app: {{ template "grafana.name" $ }}-grafana
    chart: {{ template "grafana.chart" $ }}
    release: {{ $.Release.Name }}
    dashboard-provider:  {{ $filename }}
data: 
{{ ($.Files.Glob $path).AsConfig | indent 2 }}
---

{{- end }}
